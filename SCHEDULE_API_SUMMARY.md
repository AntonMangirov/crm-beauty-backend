# API для обновления расписания мастера - Сводка

## ✅ Реализовано

### 1. Эндпоинт
**PUT** `/api/me/schedule`

Требует авторизации через токен в заголовке `Authorization: Bearer <token>`

### 2. Схема валидации (`UpdateScheduleSchema`)

**Файл**: `src/schemas/me.ts`

**Поля**:
- `workSchedule` (опционально) - массив расписаний по дням недели
- `breaks` (опционально) - массив перерывов
- `defaultBufferMinutes` (опционально) - буфер после услуги (10-30 минут)
- `slotStepMinutes` (опционально) - шаг генерации слотов (5, 10 или 15)

### 3. Валидация

✅ **Формат времени**: HH:mm (например, "09:00")
✅ **from < to**: Время начала должно быть меньше времени окончания
✅ **Нет пересечений**: Рабочие интервалы не должны пересекаться
✅ **Перерывы внутри интервалов**: Перерывы должны находиться внутри рабочих интервалов
✅ **Нет дубликатов**: Не должно быть дубликатов дней недели
✅ **Буфер**: 10-30 минут
✅ **Шаг слота**: Только 5, 10 или 15 минут

### 4. Контроллер

**Файл**: `src/controllers/meController.ts`
**Функция**: `updateSchedule`

- Валидирует данные через Zod
- Обновляет только переданные поля
- Возвращает обновленное расписание

### 5. Роут

**Файл**: `src/routes/me.ts`

```typescript
router.put(
  '/schedule',
  validate({ body: UpdateScheduleSchema }),
  updateSchedule
);
```

### 6. DTO

**Request**: `UpdateScheduleRequest`
**Response**: `UpdateScheduleResponse`

## Примеры использования

См. файл `API_SCHEDULE_EXAMPLES.md` для подробных примеров:
- Успешные запросы
- Примеры ошибок валидации
- Различные сценарии использования

## Обратная совместимость

✅ **Старый API продолжает работать** - все существующие эндпоинты не изменены
✅ **Опциональные поля** - можно обновлять только нужные поля
✅ **Значения по умолчанию** - если поля не заданы, используются дефолтные значения

## Тестирование

### Успешные сценарии

1. **Полное обновление расписания**:
   ```json
   {
     "workSchedule": [...],
     "breaks": [...],
     "defaultBufferMinutes": 20,
     "slotStepMinutes": 15
   }
   ```

2. **Частичное обновление** (только буфер и шаг):
   ```json
   {
     "defaultBufferMinutes": 25,
     "slotStepMinutes": 10
   }
   ```

3. **Только расписание**:
   ```json
   {
     "workSchedule": [...]
   }
   ```

### Ошибки валидации

1. Пересекающиеся интервалы → 400
2. Неправильный формат времени → 400
3. from >= to → 400
4. Перерыв вне рабочего интервала → 400
5. Неправильный шаг слота → 400
6. Буфер вне диапазона → 400
7. Дубликаты дней недели → 400

## Готово к использованию

✅ Эндпоинт создан
✅ Валидация реализована
✅ Контроллер работает
✅ Роут добавлен
✅ Примеры документированы


