# Примеры расчетов автоматического межуслугового буфера

## Описание функционала

Автоматический межуслуговой буфер (`autoBuffer: true`) добавляет буфер между любыми двумя процедурами, даже если у них уже есть свои буферы после услуги.

### Логика работы

1. **Буфер после услуги**: Каждое бронирование получает буфер после завершения услуги
2. **Автоматический буфер**: Если `autoBuffer: true`, между любыми двумя бронированиями добавляется `defaultBufferMinutes`
3. **Объединение**: Если буфер пересекается с перерывом - они объединяются
4. **Границы**: Если буфер выходит за рабочий интервал - слот не показывается

## Примеры расчетов

### Пример 1: Автоматический буфер между двумя услугами

**Настройки мастера**:
- `defaultBufferMinutes`: 15
- `autoBuffer`: `true`
- Рабочий интервал: 09:00-18:00

**Существующие бронирования**:
- Услуга 1: 10:00-11:00 (длительность 60 мин, буфер 15 мин) → занято до 11:15
- Услуга 2: 11:30-12:30 (длительность 60 мин, буфер 15 мин) → занято до 12:45

**Расчет**:
1. Услуга 1: 10:00-11:00 + буфер 15 мин = **10:00-11:15**
2. Промежуток между услугами: 11:15 → 11:30 = **15 минут**
3. Так как промежуток равен автоматическому буферу (15 мин), автоматический буфер не добавляется отдельно
4. Услуга 2: 11:30-12:30 + буфер 15 мин = **11:30-12:45**

**Результат**: Занято **10:00-12:45**

**Доступные слоты**: 
- 09:00-10:00
- 12:45-18:00

---

### Пример 2: Автоматический буфер добавляется между услугами

**Настройки мастера**:
- `defaultBufferMinutes`: 20
- `autoBuffer`: `true`
- Рабочий интервал: 09:00-18:00

**Существующие бронирования**:
- Услуга 1: 10:00-10:30 (длительность 30 мин, буфер 15 мин) → занято до 10:45
- Услуга 2: 11:00-12:00 (длительность 60 мин, буфер 15 мин) → занято до 12:15

**Расчет**:
1. Услуга 1: 10:00-10:30 + буфер 15 мин = **10:00-10:45**
2. Промежуток между услугами: 10:45 → 11:00 = **15 минут**
3. Так как промежуток (15 мин) < автоматического буфера (20 мин), расширяем услугу 1 до 11:00
4. Услуга 1 расширена: **10:00-11:00**
5. Услуга 2: 11:00-12:00 + буфер 15 мин = **11:00-12:15**

**Результат**: Занято **10:00-12:15**

**Доступные слоты**: 
- 09:00-10:00
- 12:15-18:00

---

### Пример 3: Автоматический буфер добавляется как отдельный интервал

**Настройки мастера**:
- `defaultBufferMinutes`: 15
- `autoBuffer`: `true`
- Рабочий интервал: 09:00-18:00

**Существующие бронирования**:
- Услуга 1: 10:00-10:30 (длительность 30 мин, буфер 15 мин) → занято до 10:45
- Услуга 2: 11:15-12:00 (длительность 45 мин, буфер 15 мин) → занято до 12:15

**Расчет**:
1. Услуга 1: 10:00-10:30 + буфер 15 мин = **10:00-10:45**
2. Промежуток между услугами: 10:45 → 11:15 = **30 минут**
3. Так как промежуток (30 мин) >= автоматического буфера (15 мин), добавляем автоматический буфер
4. Автоматический буфер: 10:45-11:00 (15 минут)
5. Услуга 2: 11:15-12:00 + буфер 15 мин = **11:15-12:15**

**Результат**: Занято:
- **10:00-10:45** (услуга 1 + буфер)
- **10:45-11:00** (автоматический буфер)
- **11:15-12:15** (услуга 2 + буфер)

**Доступные слоты**: 
- 09:00-10:00
- 11:00-11:15 (маленький промежуток, может быть исключен анти-простоем)
- 12:15-18:00

---

### Пример 4: Автоматический буфер пересекается с перерывом

**Настройки мастера**:
- `defaultBufferMinutes`: 20
- `autoBuffer`: `true`
- Рабочий интервал: 09:00-18:00
- Перерыв: 13:00-14:00

**Существующие бронирования**:
- Услуга 1: 12:30-13:00 (длительность 30 мин, буфер 15 мин) → занято до 13:15
- Услуга 2: 14:15-15:00 (длительность 45 мин, буфер 15 мин) → занято до 15:15

**Расчет**:
1. Услуга 1: 12:30-13:00 + буфер 15 мин = **12:30-13:15**
2. Промежуток между услугами: 13:15 → 14:15 = **60 минут**
3. Автоматический буфер: 13:15-13:35 (20 минут)
4. Перерыв: 13:00-14:00
5. Автоматический буфер (13:15-13:35) пересекается с перерывом (13:00-14:00) → **объединяем**
6. Объединенный интервал: **12:30-14:00** (услуга 1 + буфер + перерыв)
7. Услуга 2: 14:15-15:00 + буфер 15 мин = **14:15-15:15**

**Результат**: Занято:
- **12:30-14:00** (услуга 1 + буфер + перерыв объединены)
- **14:15-15:15** (услуга 2 + буфер)

**Доступные слоты**: 
- 09:00-12:30
- 15:15-18:00

---

### Пример 5: Автоматический буфер выходит за рабочий интервал

**Настройки мастера**:
- `defaultBufferMinutes`: 30
- `autoBuffer`: `true`
- Рабочий интервал: 09:00-18:00

**Существующие бронирования**:
- Услуга 1: 17:30-18:00 (длительность 30 мин, буфер 15 мин) → занято до 18:15

**Расчет**:
1. Услуга 1: 17:30-18:00 + буфер 15 мин = **17:30-18:15**
2. Буфер (18:00-18:15) выходит за рабочий интервал (09:00-18:00)
3. Буфер обрезается до конца рабочего интервала: **17:30-18:00**

**Результат**: Занято **17:30-18:00**

**Доступные слоты**: 
- 09:00-17:30

**Примечание**: Слоты после 18:00 не генерируются, так как выходят за рабочий интервал

---

### Пример 6: Без автоматического буфера (autoBuffer: false)

**Настройки мастера**:
- `defaultBufferMinutes`: 15
- `autoBuffer`: `false`
- Рабочий интервал: 09:00-18:00

**Существующие бронирования**:
- Услуга 1: 10:00-10:30 (длительность 30 мин, буфер 15 мин) → занято до 10:45
- Услуга 2: 11:00-12:00 (длительность 60 мин, буфер 15 мин) → занято до 12:15

**Расчет**:
1. Услуга 1: 10:00-10:30 + буфер 15 мин = **10:00-10:45**
2. Услуга 2: 11:00-12:00 + буфер 15 мин = **11:00-12:15**
3. Автоматический буфер НЕ добавляется

**Результат**: Занято:
- **10:00-10:45** (услуга 1 + буфер)
- **11:00-12:15** (услуга 2 + буфер)

**Доступные слоты**: 
- 09:00-10:00
- **10:45-11:00** (промежуток доступен для записи!)
- 12:15-18:00

---

### Пример 7: Множественные услуги с автоматическим буфером

**Настройки мастера**:
- `defaultBufferMinutes`: 15
- `autoBuffer`: `true`
- Рабочий интервал: 09:00-18:00

**Существующие бронирования**:
- Услуга 1: 10:00-10:30 (30 мин, буфер 15 мин)
- Услуга 2: 11:00-11:45 (45 мин, буфер 15 мин)
- Услуга 3: 13:00-14:00 (60 мин, буфер 15 мин)

**Расчет**:
1. Услуга 1: 10:00-10:30 + буфер = **10:00-10:45**
2. Промежуток 1: 10:45 → 11:00 = 15 мин = автоматический буфер → расширяем услугу 1 до **10:00-11:00**
3. Услуга 2: 11:00-11:45 + буфер = **11:00-12:00**
4. Промежуток 2: 12:00 → 13:00 = 60 мин > автоматический буфер → добавляем автоматический буфер **12:00-12:15**
5. Услуга 3: 13:00-14:00 + буфер = **13:00-14:15**

**Результат**: Занято:
- **10:00-11:00** (услуга 1 + буфер + автоматический буфер)
- **11:00-12:00** (услуга 2 + буфер)
- **12:00-12:15** (автоматический буфер)
- **13:00-14:15** (услуга 3 + буфер)

**Доступные слоты**: 
- 09:00-10:00
- 12:15-13:00
- 14:15-18:00

---

### Пример 8: Автоматический буфер с разными буферами услуг

**Настройки мастера**:
- `defaultBufferMinutes`: 15
- `autoBuffer`: `true`
- Рабочий интервал: 09:00-18:00

**Существующие бронирования**:
- Услуга 1: 10:00-10:30 (30 мин, свой буфер 20 мин) → занято до 10:50
- Услуга 2: 11:00-12:00 (60 мин, свой буфер 10 мин) → занято до 12:10

**Расчет**:
1. Услуга 1: 10:00-10:30 + свой буфер 20 мин = **10:00-10:50**
2. Промежуток: 10:50 → 11:00 = 10 мин < автоматический буфер (15 мин) → расширяем услугу 1 до **10:00-11:00**
3. Услуга 2: 11:00-12:00 + свой буфер 10 мин = **11:00-12:10**

**Результат**: Занято **10:00-12:10**

**Примечание**: Автоматический буфер использует `defaultBufferMinutes` (15 мин), а не индивидуальные буферы услуг

---

## Итоговая логика

1. **Буфер после услуги**: Всегда добавляется к каждому бронированию
2. **Автоматический буфер**: Добавляется между бронированиями только если `autoBuffer: true`
3. **Объединение**: Пересекающиеся интервалы (буферы, перерывы) автоматически объединяются
4. **Границы**: Буферы обрезаются границами рабочего интервала
5. **Слоты**: Генерируются только в свободных интервалах внутри рабочего времени



